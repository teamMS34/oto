<!DOCTYPE html>
<html lang="tr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Hesapla - OtoMaliyet</title>

<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700;800&display=swap" rel="stylesheet">
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

<style>
*{margin:0;padding:0;box-sizing:border-box;font-family:'Inter',sans-serif;}

body{
    background:linear-gradient(135deg,#0f2c5c,#1f4fa3);
    min-height:100vh;
}

.navbar{
    background:white;
    padding:20px 8%;
    display:flex;
    justify-content:space-between;
    align-items:center;
}

.logo{
    font-weight:800;
    font-size:20px;
    color:#162b52;
}

.navbar a{
    text-decoration:none;
    color:#162b52;
    font-weight:600;
}

.main{
    display:flex;
    gap:40px;
    padding:60px 8%;
}

.card{
    background:white;
    padding:35px;
    border-radius:22px;
    flex:1;
    box-shadow:0 25px 60px rgba(0,0,0,0.15);
}

.card h2{
    margin-bottom:25px;
    color:#162b52;
}

.input-group{
    margin-bottom:18px;
}

.input-group label{
    display:block;
    margin-bottom:6px;
    font-size:14px;
    font-weight:600;
}

.hint-text{
    font-size:12px;
    color:#b0b0b0;
    margin-left:6px;
    font-weight:400;
}

.input-group input{
    width:100%;
    padding:13px;
    border-radius:12px;
    border:1px solid #e3e6ee;
    background:#f9fbff;
    font-size:15px;
}

button{
    width:100%;
    padding:15px;
    border:none;
    border-radius:14px;
    background:linear-gradient(90deg,#162b52,#1f3d73);
    color:white;
    font-weight:600;
    cursor:pointer;
}

.big-result{
    background:linear-gradient(135deg,#162b52,#1f3d73);
    color:white;
    padding:25px;
    border-radius:18px;
    margin-bottom:20px;
}

.big-result h3{
    font-size:13px;
    opacity:.7;
    margin-bottom:8px;
}

.big-result .value{
    font-size:30px;
    font-weight:800;
}

.small-result{
    background:#f4f7fb;
    padding:12px;
    border-radius:12px;
    margin-bottom:10px;
    font-weight:600;
}

.progress-bar{
    width:100%;
    height:26px;
    background:#e8ecf4;
    border-radius:20px;
    overflow:hidden;
    margin-top:15px;
}

.progress-fill{
    height:100%;
    width:0%;
    background:linear-gradient(90deg,#4caf50,#ff9800,#f44336);
    transition:.6s;
    display:flex;
    align-items:center;
    justify-content:center;
    color:white;
    font-weight:700;
}

.risk-text{
    margin-top:10px;
    font-weight:700;
}

.recommendation{
    margin-top:15px;
    padding:15px;
    border-radius:12px;
    font-weight:600;
    transition:.3s;
}

/* Renk sistemleri */
.rec-success{
    background:#e6f4ea;
    color:#1e7e34;
}

.rec-warning{
    background:#fff4e5;
    color:#b26a00;
}

.rec-danger{
    background:#fdecea;
    color:#b42318;
}

.input-error{
    border:2px solid #e74c3c !important;
    background:#fdecea;
}

.input-card{ flex:4; }
.result-card{ flex:6; }

@media(max-width:1000px){
    .main{flex-direction:column;}
}
</style>
</head>
<body>

<div class="navbar">
    <div class="logo">ðŸš— OtoMaliyet</div>
    <a href="index.html">Ana Sayfa</a>
</div>

<div class="main">

<div class="card input-card">
    <h2>AraÃ§ Bilgileri</h2>

    <div class="input-group"><label>YÄ±llÄ±k KM</label><input type="text" id="km" class="format"></div>
    <div class="input-group"><label>YakÄ±t TÃ¼ketimi (L/100km)</label><input type="text" id="tuketim" class="format"></div>
    <div class="input-group"><label>YakÄ±t FiyatÄ± (TL)</label><input type="text" id="yakit" class="format"></div>
    <div class="input-group"><label>Sigorta FiyatÄ± (YÄ±llÄ±k)</label><input type="text" id="sigorta" class="format"></div>

    <div class="input-group">
        <label>
            Kasko FiyatÄ± (YÄ±llÄ±k)
            <span class="hint-text">Kaskonuz Yoksa BoÅŸ BÄ±rakabilirsiniz</span>
        </label>
        <input type="text" id="kasko" class="format">
    </div>

    <div class="input-group"><label>MTV FiyatÄ± (YÄ±llÄ±k)</label><input type="text" id="mtv" class="format"></div>
    <div class="input-group"><label>BakÄ±m FiyatÄ± (YÄ±llÄ±k)</label><input type="text" id="bakim" class="format"></div>
    <div class="input-group"><label>AylÄ±k Gelir</label><input type="text" id="gelir" class="format"></div>

    <button onclick="hesapla()">Maliyeti Hesapla</button>
</div>

<div class="card result-card">
    <h2>SonuÃ§</h2>

    <div class="big-result">
        <h3>YILLIK TOPLAM MALÄ°YET</h3>
        <div class="value" id="yillik">-</div>
    </div>

    <div class="small-result" id="aylik">AylÄ±k Ortalama Maliyet: -</div>
    <div class="small-result" id="kmMaliyet">KM BaÅŸÄ±na Maliyet: -</div>

    <div class="progress-bar">
        <div class="progress-fill" id="progressFill">0%</div>
    </div>

    <div class="risk-text" id="riskText">Risk Durumu: -</div>

    <canvas id="costChart" height="120" style="margin-top:30px;"></canvas>

    <div class="recommendation" id="recommendation">
        Ã–neri burada gÃ¶rÃ¼necek.
    </div>

</div>
</div>

<script>

let chart;

function formatTR(num, fraction = 0){
    return num.toLocaleString("tr-TR", {
        minimumFractionDigits: fraction,
        maximumFractionDigits: fraction
    });
}

document.querySelectorAll(".format").forEach(input => {
    input.addEventListener("input", function(){
        let value = this.value;
        value = value.replace(/\./g,'');
        value = value.replace(/[^0-9,]/g,'');

        let parts = value.split(",");
        if(parts.length > 2){
            value = parts[0] + "," + parts[1];
        }

        let split = value.split(",");
        let integerPart = split[0];
        let decimalPart = split[1];

        if(integerPart){
            integerPart = Number(integerPart).toLocaleString("tr-TR");
        }

        this.value = decimalPart !== undefined
            ? integerPart + "," + decimalPart
            : integerPart;
    });
});

function getNumber(id){
    let value = document.getElementById(id).value;
    value = value.replace(/\./g,'');
    value = value.replace(",", ".");
    return parseFloat(value) || 0;
}

function hesapla(){

    let rec = document.getElementById("recommendation");
    rec.classList.remove("rec-success","rec-warning","rec-danger");

    let fields = [
        {id:"km", name:"YÄ±llÄ±k KM"},
        {id:"tuketim", name:"Ortalama TÃ¼ketim"},
        {id:"yakit", name:"YakÄ±t FiyatÄ±"},
        {id:"sigorta", name:"Sigorta"},
        {id:"mtv", name:"MTV"},
        {id:"bakim", name:"BakÄ±m"},
        {id:"gelir", name:"AylÄ±k Gelir"}
    ];

    let eksikAlanlar = [];

    fields.forEach(f=>{
        document.getElementById(f.id).classList.remove("input-error");
        if(getNumber(f.id) <= 0){
            eksikAlanlar.push(f);
        }
    });

    if(eksikAlanlar.length > 0){

        eksikAlanlar.forEach(f=>{
            document.getElementById(f.id).classList.add("input-error");
        });

        rec.classList.add("rec-danger");
        rec.innerText =
            "LÃ¼tfen ÅŸu alanlarÄ± doldurun: " +
            eksikAlanlar.map(f=>f.name).join(", ");

        document.getElementById("progressFill").style.width="0%";
        document.getElementById("progressFill").innerText="0%";
        document.getElementById("riskText").innerText="Risk Durumu: -";

        if(chart) chart.destroy();
        return;
    }

    let km = getNumber("km");
    let tuketim = getNumber("tuketim");
    let yakit = getNumber("yakit");
    let sigorta = getNumber("sigorta");
    let kasko = getNumber("kasko");
    let mtv = getNumber("mtv");
    let bakim = getNumber("bakim");
    let gelir = getNumber("gelir");

    let yillikYakit = (km/100)*tuketim*yakit;
    let toplam = yillikYakit + sigorta + kasko + mtv + bakim;
    let aylik = toplam/12;
    let kmBasi = toplam/km;

    document.getElementById("yillik").innerText =
        formatTR(toplam) + " TL";

    document.getElementById("aylik").innerText =
        "AylÄ±k Ortalama Maliyet: " +
        formatTR(aylik) + " TL";

    document.getElementById("kmMaliyet").innerText =
        "KM BaÅŸÄ±na Maliyet: " +
        formatTR(kmBasi,2) + " TL";

    let yuzde = (aylik/gelir)*100;
    if(yuzde>100) yuzde=100;

    document.getElementById("progressFill").style.width = yuzde + "%";
    document.getElementById("progressFill").innerText =
        formatTR(yuzde,1) + "%";

    let risk;

    if(yuzde<=20){
        risk="âœ” GÃ¼venli";
        rec.classList.add("rec-success");
        rec.innerText="Bu araÃ§ bÃ¼tÃ§ene uygun gÃ¶rÃ¼nÃ¼yor.";
    }
    else if(yuzde<=35){
        risk="âš  Orta Risk";
        rec.classList.add("rec-warning");
        rec.innerText="BÃ¼tÃ§e planlamasÄ±nÄ± dikkatli yapmalÄ±sÄ±n.";
    }
    else{
        risk="âŒ YÃ¼ksek Risk";
        rec.classList.add("rec-danger");
        rec.innerText="Bu araÃ§ gelirine gÃ¶re riskli olabilir.";
    }

    document.getElementById("riskText").innerText =
        "AylÄ±k Gelire OranÄ±: %" +
        formatTR(yuzde,1) +
        " â†’ " + risk;

    let ctx = document.getElementById('costChart').getContext('2d');
    if(chart) chart.destroy();

    chart = new Chart(ctx, {
        type:'bar',
        data:{
            labels:['YakÄ±t','Sigorta','Kasko','MTV','BakÄ±m'],
            datasets:[{
                label:"YÄ±llÄ±k Gider DaÄŸÄ±lÄ±mÄ± (TL)",
                data:[yillikYakit,sigorta,kasko,mtv,bakim],
                borderRadius:8
            }]
        },
        options:{
            responsive:true,
            animation:{duration:1000},
            plugins:{
                legend:{
                    display:true,
                    labels:{
                        font:{
                            size:14,
                            weight:'600'
                        }         
                    }      
                },    
                title:{
                    display:true,
                    text:"AraÃ§ YÄ±llÄ±k Maliyet DaÄŸÄ±lÄ±mÄ±",
                    font:{
                        size:18,
                        weight:'700'
                    },      
                    padding:{
                        top:10,
                        bottom:20
                    }   
                },                
                tooltip:{
                    callbacks:{
                        label:function(context){
                            return context.label + ": " +
                            formatTR(context.raw) + " TL";
                        }
                    }
                }
            },
            scales:{
                y:{
                    beginAtZero:true,
                    ticks:{
                        callback:function(value){
                            return formatTR(value) + " TL";
                        }
                    }
                }
            }
        }
    });
}

</script>

</body>
</html>
